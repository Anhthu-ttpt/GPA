
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>üéì GPA & CPA Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f4f6fb;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 24px;
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.08);
    }
    h1 {
      text-align: center;
      margin-bottom: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #eef2ff;
    }
    button {
      padding: 8px 14px;
      margin: 6px 4px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background: #4f46e5;
      color: white;
    }
    button.secondary {
      background: #64748b;
    }
    .result {
      margin-top: 16px;
      font-size: 18px;
      font-weight: bold;
    }
    canvas {
      margin-top: 20px;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>üéì GPA & CPA Calculator</h1>

  <button onclick="addRow()">‚ûï Th√™m m√¥n</button>
  <button class="secondary" onclick="clearData()">üóëÔ∏è X√≥a d·ªØ li·ªáu</button>

  <table id="gradeTable">
    <tr>
      <th>M√¥n h·ªçc</th>
      <th>S·ªë t√≠n ch·ªâ</th>
      <th>ƒêi·ªÉm h·ªá 10</th>
      <th>ƒêi·ªÉm h·ªá 4</th>
    </tr>
  </table>

  <button onclick="calculate()">üìä T√≠nh GPA / CPA</button>

  <div class="result" id="output"></div>

  <canvas id="chart" height="100"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
function he10to4(x){
  if (x >= 8.5) return 4;
  if (x >= 7.0) return 3;
  if (x >= 5.5) return 2;
  if (x >= 4.0) return 1;
  return 0;
}

function classify(gpa){
  if (gpa >= 3.6) return "Xu·∫•t s·∫Øc";
  if (gpa >= 3.2) return "Gi·ªèi";
  if (gpa >= 2.5) return "Kh√°";
  if (gpa >= 2.0) return "Trung b√¨nh";
  return "Y·∫øu";
}

function addRow(data = {}){
  const table = document.getElementById("gradeTable");
  const row = table.insertRow();
  row.innerHTML = `
    <td><input value="${data.name||''}"></td>
    <td><input type="number" value="${data.tc||''}"></td>
    <td><input type="number" step="0.1" value="${data.d10||''}"></td>
    <td class="d4"></td>
  `;
}

function calculate(){
  let rows = document.querySelectorAll("#gradeTable tr");
  let sumTC = 0, sum4 = 0;
  let labels = [], dataChart = [];

  let saved = [];

  rows.forEach((r, i) => {
    if (i === 0) return;
    let name = r.cells[0].children[0].value;
    let tc = parseFloat(r.cells[1].children[0].value);
    let d10 = parseFloat(r.cells[2].children[0].value);
    if (isNaN(tc) || isNaN(d10)) return;

    let d4 = he10to4(d10);
    r.cells[3].innerText = d4;

    sumTC += tc;
    sum4 += d4 * tc;

    labels.push(name || "M√¥n");
    dataChart.push(d4);

    saved.push({name, tc, d10});
  });

  localStorage.setItem("grades", JSON.stringify(saved));

  let gpa = sum4 / sumTC;
  document.getElementById("output").innerHTML =
    `üìà GPA/CPA: <b>${gpa.toFixed(2)}</b> ‚Äî üéì ${classify(gpa)}`;

  drawChart(labels, dataChart);
}

let chart;
function drawChart(labels, data){
  if (chart) chart.destroy();
  chart = new Chart(document.getElementById("chart"), {
    type: 'bar',
    data: {
      labels,
      datasets: [{
        label: 'ƒêi·ªÉm h·ªá 4',
        data
      }]
    }
  });
}

function clearData(){
  localStorage.removeItem("grades");
  location.reload();
}

(function load(){
  let saved = JSON.parse(localStorage.getItem("grades") || "[]");
  saved.forEach(s => addRow(s));
})();
</script>
</body>
</html>
